package cc.zenith.features.modules.impl.exploit.disablers.verus;

import cc.zenith.events.impl.network.PacketEvent;
import cc.zenith.events.impl.player.MoveEvent;
import cc.zenith.events.impl.player.UpdateEvent;
import cc.zenith.features.modules.impl.exploit.disablers.IDisabler;
import cc.zenith.utils.client.MC;
import cc.zenith.utils.network.PacketUtil;
import net.minecraft.network.play.client.C00PacketKeepAlive;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.server.S37PacketStatistics;

public class VerusReachDisabler implements IDisabler {


    int transactions = 0;
    short newTransaction = 0;

    @Override
    public void onEnable() {
        transactions = 0;
        newTransaction = 0;

    }

    @Override
    public void onUpdate(UpdateEvent event) {
        if (MC.getPlayer().ticksExisted % 600 == 0) {
            PacketUtil.send(new C00PacketKeepAlive());
        }
    }

    @Override
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof C00PacketKeepAlive) {
            event.cancel();
        }
        if (event.getPacket() instanceof C0FPacketConfirmTransaction) {
            transactions++;
            if (transactions <= 1) {
                newTransaction = ((C0FPacketConfirmTransaction) event.getPacket()).getUid();
            }
            ((C0FPacketConfirmTransaction) event.getPacket()).uid = newTransaction;
        }

        if (event.getPacket() instanceof S37PacketStatistics) {
            transactions = 0;
        }
    }

    @Override
    public String toString() {
        return "Verus Reach";
    }
}
