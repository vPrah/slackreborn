package cc.zenith.features.modules.impl.exploit;

import cc.zenith.Zenith;
import cc.zenith.events.impl.network.PacketEvent;
import cc.zenith.features.modules.api.Category;
import cc.zenith.features.modules.api.Module;
import cc.zenith.features.modules.api.ModuleInfo;
import cc.zenith.features.modules.api.settings.impl.ModeValue;
import cc.zenith.utils.client.MC;
import cc.zenith.utils.network.PacketUtil;
import cc.zenith.utils.other.PrintUtil;
import io.github.nevalackin.radbus.Listen;
import net.minecraft.network.play.client.C02PacketUseEntity;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.server.S37PacketStatistics;
import net.minecraft.network.play.server.S40PacketDisconnect;

@ModuleInfo(
        name = "Kick",
        category = Category.EXPLOIT
)
public class Kick extends Module {

    private final ModeValue<String> mode = new ModeValue<>(new String[]{"Quit", "ClientSideQuit", "InvalidPacket", "Selfhurt"});

    public Kick() {
        super();
        addSettings(mode);
    }

    @Override
    public void onEnable() {
        if (MC.getMinecraft().isIntegratedServerRunning()) {
            PrintUtil.message("You can't enable §c§l'Kick' §ain SinglePlayer.");
            return;
        }
        switch (mode.getValue().toLowerCase()) {
            case "quit":
                MC.getWorld().sendQuittingDisconnectingPacket();
                break;
            case "clientsidequit":
                PacketUtil.send(new S40PacketDisconnect());
                break;
            case "invalidpacket":
                MC.getNetHandler().addToSendQueue(new C03PacketPlayer.C04PacketPlayerPosition(Double.NEGATIVE_INFINITY, Double.NEGATIVE_INFINITY, Double.POSITIVE_INFINITY, !MC.getPlayer().onGround));
                break;
            case "selfhurt":
                MC.getNetHandler().addToSendQueue(new C02PacketUseEntity(MC.getPlayer(), C02PacketUseEntity.Action.ATTACK));
                break;
        }
    }

    @Listen
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof S37PacketStatistics) {
            Zenith.getInstance().getModuleManager().getInstance(Kick.class).setToggle(false);
        }
    }
}
